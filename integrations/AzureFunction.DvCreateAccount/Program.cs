using Microsoft.Azure.Functions.Worker; using Microsoft.Azure.Functions.Worker.Http; using Microsoft.PowerPlatform.Dataverse.Client; using Microsoft.Xrm.Sdk; using System; using System.Net; using System.Text.Json; public class CreateAccountFunction{[Function("CreateAccount")] public async System.Threading.Tasks.Task<HttpResponseData> Run([HttpTrigger(AuthorizationLevel.Function, "post")] HttpRequestData req){var body=await JsonSerializer.DeserializeAsync<CreateAccountDto>(req.Body,new JsonSerializerOptions{PropertyNameCaseInsensitive=true});var conn=Environment.GetEnvironmentVariable("DATAVERSE_CONNECTION");using var svc=new ServiceClient(conn);var account=new Entity("account");account["name"]=body?.Name??"API Account";if(!string.IsNullOrWhiteSpace(body?.Email))account["emailaddress1"]=body!.Email;var id=svc.Create(account);var res=req.CreateResponse(HttpStatusCode.OK);await res.WriteStringAsync(JsonSerializer.Serialize(new { id }));return res;} public class CreateAccountDto{public string? Name{get;set;} public string? Email{get;set;}}}