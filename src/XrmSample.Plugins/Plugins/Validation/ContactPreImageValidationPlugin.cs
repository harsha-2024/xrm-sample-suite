using System;using Microsoft.Xrm.Sdk;namespace XrmSample.Plugins.Plugins.Validation{public class ContactPreImageValidationPlugin:XrmSample.Plugins.PluginBase{public ContactPreImageValidationPlugin(string u,string s):base(u,s){}protected override void ExecutePlugin(IPluginExecutionContext c,IOrganizationService s,ITracingService t){if(c.MessageName!="Update")return;if(!(c.InputParameters.Contains("Target")&&c.InputParameters["Target"] is Entity target))return;if(target.LogicalName!="contact")return;if(!c.PreEntityImages.Contains("PreImage"))return;var pre=c.PreEntityImages["PreImage"];var doNotAllow=pre.GetAttributeValue<bool?>("new_donotallownamechange")??false;if(doNotAllow&&target.Attributes.Contains("lastname"))throw new InvalidPluginExecutionException("Last name changes are not allowed for this contact.");}}}