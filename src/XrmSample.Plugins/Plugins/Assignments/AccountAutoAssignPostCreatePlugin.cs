using System;using Microsoft.Xrm.Sdk;using Microsoft.Xrm.Sdk.Messages;using System.Web.Script.Serialization;namespace XrmSample.Plugins.Plugins.Assignments{public class AccountAutoAssignPostCreatePlugin:XrmSample.Plugins.PluginBase{public AccountAutoAssignPostCreatePlugin(string u,string s):base(u,s){}protected override void ExecutePlugin(IPluginExecutionContext c,IOrganizationService s,ITracingService t){if(c.MessageName!="Create")return;if(!(c.OutputParameters.Contains("id")&&c.OutputParameters["id"] is Guid accountId))return;Guid teamId=Guid.Empty;try{if(!string.IsNullOrWhiteSpace(UnsecureConfig)){var json=new JavaScriptSerializer().Deserialize<dynamic>(UnsecureConfig);if(json!=null&&json.ContainsKey("teamId")){Guid.TryParse(json["teamId"],out teamId);}}}catch{}if(teamId!=Guid.Empty){var req=new AssignRequest{Assignee=new EntityReference("team",teamId),Target=new EntityReference("account",accountId)};s.Execute(req);} }} }