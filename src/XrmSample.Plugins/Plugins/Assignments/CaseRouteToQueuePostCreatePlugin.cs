using System;using Microsoft.Xrm.Sdk;using Microsoft.Xrm.Sdk.Messages;namespace XrmSample.Plugins.Plugins.Assignments{public class CaseRouteToQueuePostCreatePlugin:XrmSample.Plugins.PluginBase{protected override void ExecutePlugin(IPluginExecutionContext c,IOrganizationService s,ITracingService t){if(c.MessageName!="Create"||!c.PrimaryEntityName.Equals("incident",StringComparison.OrdinalIgnoreCase))return;if(!(c.OutputParameters.Contains("id")&&c.OutputParameters["id"] is Guid caseId))return;int priority=2;if(c.InputParameters.Contains("Target")&&c.InputParameters["Target"] is Entity target&&target.Contains("prioritycode")){var opt=target.GetAttributeValue<OptionSetValue>("prioritycode");if(opt!=null)priority=opt.Value;}Guid highPriorityQueue=Guid.Empty,defaultQueue=Guid.Empty;var queueId=priority==1&&highPriorityQueue!=Guid.Empty?highPriorityQueue:defaultQueue;if(queueId!=Guid.Empty){var add=new AddToQueueRequest{DestinationQueueId=queueId,Target=new EntityReference("incident",caseId)};s.Execute(add);} }}}