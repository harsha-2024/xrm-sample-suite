using System;using Microsoft.Xrm.Sdk;namespace XrmSample.Plugins{public abstract class PluginBase:IPlugin{protected readonly string UnsecureConfig;protected readonly string SecureConfig;protected PluginBase(string unsecure=null,string secure=null){UnsecureConfig=unsecure;SecureConfig=secure;}public void Execute(IServiceProvider sp){var tracing=(ITracingService)sp.GetService(typeof(ITracingService));var ctx=(IPluginExecutionContext)sp.GetService(typeof(IPluginExecutionContext));var factory=(IOrganizationServiceFactory)sp.GetService(typeof(IOrganizationServiceFactory));var svc=factory.CreateOrganizationService(ctx.UserId);try{ExecutePlugin(ctx,svc,tracing);}catch(InvalidPluginExecutionException){throw;}catch(Exception ex){tracing?.Trace($"Unhandled: {ex}");throw new InvalidPluginExecutionException("An unexpected error occurred in XrmSample.Plugins.",ex);} }protected abstract void ExecutePlugin(IPluginExecutionContext c,IOrganizationService s,ITracingService t);} }